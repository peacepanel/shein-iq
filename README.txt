# 🚀 SHIQ PWA v2.0 - النظام المحدث مع إدارة المستخدمين والإشعارات

## 🆕 الميزات الجديدة

### ✨ **إدارة المستخدمين المتقدمة:**
- 🆔 **معرف فريد لكل مستخدم** - تتبع دقيق للعملاء
- 📝 **تسجيل بيانات شاملة** - الاسم، الهاتف، العنوان، المحافظة
- 🎯 **اهتمامات المستخدم** - لإشعارات مخصصة
- 📊 **حفظ آمن للبيانات** - محلياً وفي Google Sheets

### 🔔 **نظام إشعارات ذكي:**
- 📱 **إشعارات فورية** للعروض والمنتجات الجديدة
- 🎯 **استهداف دقيق** حسب المحافظة والاهتمامات
- ⏰ **إشعارات مجدولة** (يومية، أسبوعية، موسمية)
- 🤖 **إشعارات ذكية** حسب سلوك المستخدم

### 🛒 **تحسينات سلة التسوق:**
- 👤 **معلومات العميل** تظهر تلقائياً في الطلب
- 📍 **عنوان التوصيل** محفوظ مسبقاً
- 📞 **رقم الهاتف** جاهز للتواصل
- 🏠 **توصيل محدد حسب المحافظة**

---

## 📁 **هيكل المشروع المحدث**

```
shiq-app-v2/
├── index.html              # الواجهة الرئيسية مع نماذج التسجيل
├── app.js                  # منطق التطبيق + إدارة المستخدمين
├── sw.js                   # Service Worker + إشعارات متقدمة
├── manifest.json           # PWA Manifest
├── package.json            # إعدادات المشروع
├── .gitignore             # ملفات التجاهل
├── icons/                 # أيقونات التطبيق
│   ├── icon-192x192.png
│   └── icon-512x512.png
├── scripts/               # سكريبت Google Apps
│   └── notifications.gs   # إدارة الإشعارات
└── docs/                  # التوثيق
    ├── README-UPDATED.md
    └── SETUP-GUIDE.md
```

---

## 🚀 **دليل الإعداد السريع**

### **الخطوة 1: رفع الملفات المحدثة**
```bash
# استبدل الملفات القديمة بالجديدة
git add .
git commit -m "Update: Advanced User System + Smart Notifications"
git push origin main
```

### **الخطوة 2: إعداد Google Sheets**

#### **أنشئ 4 جداول جديدة:**

**1️⃣ جدول المستخدمين (`Users`):**
| A | B | C | D | E | F | G | H | I | J | K | L |
|---|---|---|---|---|---|---|---|---|---|---|---|
| **التاريخ** | **معرف المستخدم** | **الاسم** | **الهاتف** | **المحافظة** | **العنوان** | **الجنس** | **الاهتمامات** | **الإشعارات** | **تاريخ التسجيل** | **آخر نشاط** | **معلومات الجهاز** |

**2️⃣ جدول الإشعارات (`Notifications`):**
| A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|
| **التاريخ** | **العنوان** | **المحتوى** | **الجمهور المستهدف** | **عدد الإرسال** | **معدل النجاح** | **النوع** |

**3️⃣ جدول الطلبات (`Orders`):**
| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| **التاريخ** | **معرف المستخدم** | **اسم العميل** | **الهاتف** | **المحافظة** | **المنتجات** | **المبلغ الكلي** | **الحالة** | **وقت الطلب** |

**4️⃣ جدول الإحصائيات (`Analytics`):**
| A | B | C | D | E | F |
|---|---|---|---|---|---|
| **التاريخ** | **نوع الحدث** | **عدد المستخدمين** | **معدل التفاعل** | **المحافظة** | **التفاصيل** |

### **الخطوة 3: إعداد Google Apps Script**
1. اذهب إلى [script.google.com](https://script.google.com)
2. **مشروع جديد** → الصق كود `notifications.gs`
3. **غيّر المعرفات:**
   ```javascript
   const CONFIG = {
     USERS_SHEET_ID: 'معرف_جدول_المستخدمين',
     NOTIFICATIONS_SHEET_ID: 'معرف_جدول_الإشعارات',
     // ... باقي المعرفات
   };
   ```
4. **احفظ ونشر** كـ Web App

### **الخطوة 4: إعداد Firebase (للإشعارات)**
1. اذهب إلى [Firebase Console](https://console.firebase.google.com)
2. **مشروع جديد** → اسم المشروع: `shiq-notifications`
3. **Project Settings** → **Cloud Messaging**
4. **Generate Key Pair** → انسخ المفاتيح
5. ضع المفاتيح في Google Apps Script

---

## 🎯 **المحافظات العراقية المدعومة**

### **📍 القائمة الكاملة:**
- بغداد
- البصرة  
- نينوى
- أربيل
- النجف
- كربلاء
- بابل
- الأنبار
- ذي قار
- القادسية
- كركوك
- واسط
- صلاح الدين
- المثنى
- ديالى
- ميسان
- دهوك
- السليمانية

---

## 🔔 **أنواع الإشعارات المتاحة**

### **📅 إشعارات مجدولة:**
```javascript
// يومية
"صباح الخير من شي ان العراق" - 9 صباحاً
"عروض مسائية خاصة" - 6 مساءً

// أسبوعية  
"استعد لعطلة نهاية الأسبوع" - خميس 6 مساءً

// موسمية
"مجموعة رمضان الكريم" - بداية رمضان
"هدايا عيد الأم" - 21 مارس
"العودة للمدارس" - سبتمبر
```

### **🎯 إشعارات مخصصة:**
```javascript
// حسب المحافظة
"عروض خاصة لسكان بغداد"

// حسب الاهتمامات
"منتجات جديدة في الاكسسوارات النسائية"

// حسب السلوك
"لا تنس سلة التسوق" - بعد 24 ساعة من الإضافة
"أهلاً بعودتك" - بعد 7 أيام من آخر زيارة
```

---

## 🛠️ **كيفية إرسال إشعار فوري**

### **الطريقة الأولى: من Google Sheets**
1. افتح جدول `Notifications`
2. أضف سطر جديد:
   ```
   التاريخ: الآن
   العنوان: 🔥 عرض خاص
   المحتوى: خصم 50% لمدة 3 ساعات فقط
   الجمهور: all (أو محافظة محددة)
   ```
3. **احفظ** → سيُرسل خلال 5 دقائق

### **الطريقة الثانية: من Google Apps Script**
```javascript
// إرسال فوري لجميع المستخدمين
sendNotificationToUsers({
  title: '🛍️ منتجات جديدة وصلت',
  body: 'تصفح أحدث مجموعة من الملابس النسائية',
  audience: 'all',
  type: 'new_products'
});

// إرسال لمحافظة محددة
sendNotificationToUsers({
  title: '🚚 توصيل مجاني في بغداد',
  body: 'توصيل مجاني لجميع الطلبات اليوم',
  audience: 'governorate',
  governorate: 'بغداد',
  type: 'delivery_offer'
});
```

---

## 📊 **تتبع الإحصائيات**

### **📈 المؤشرات المتاحة:**
- **عدد المستخدمين الجدد** يومياً/أسبوعياً
- **معدل فتح الإشعارات** لكل نوع
- **أكثر المحافظات تفاعلاً**
- **أشهر الاهتمامات** بين المستخدمين
- **معدل تحويل الإشعارات لطلبات**

### **📋 التقارير التلقائية:**
- **تقرير يومي** - 11 مساءً كل يوم
- **تقرير أسبوعي** - أحد 9 صباحاً  
- **تقرير شهري** - أول الشهر

---

## 🔧 **استكشاف الأخطاء**

### **❌ المستخدم لا يتلقى إشعارات:**

**التحقق:**
```javascript
// في المتصفح Developer Tools
console.log('Notification permission:', Notification.permission);
console.log('User data:', localStorage.getItem('shiq_user_data'));
```

**الحلول:**
1. تأكد من إذن الإشعارات: `Notification.permission === 'granted'`
2. تحقق من تفعيل الإشعارات للمستخدم
3. تأكد من صحة Firebase Keys
4. فحص Google Apps Script logs

### **❌ بيانات المستخدم لا تُحفظ:**

**التحقق:**
- افتح Developer Tools → Application → Local Storage
- ابحث عن `shiq_user_data`

**الحلول:**
- تأكد من عمل Google Apps Script
- تحقق من صحة معرفات الجداول
- فحص API endpoints

---

## 📱 **تجربة المستخدم الجديدة**

### **🆕 للمستخدمين الجدد:**
1. **فتح التطبيق** → رسالة ترحيب
2. **نموذج التسجيل** يظهر بعد 3 ثوانِ
3. **ملء البيانات** + اختيار الاهتمامات
4. **طلب إذن الإشعارات**
5. **رسالة ترحيب شخصية** مع الاسم والمحافظة

### **🔄 للمستخدمين العائدين:**
1. **فتح التطبيق** → رسالة ترحيب شخصية
2. **زر الملف الشخصي** متاح في الزاوية
3. **بيانات محفوظة** في سلة التسوق
4. **إشعارات مخصصة** حسب الاهتمامات

---

## 🎯 **أهداف النظام الجديد**

### **✅ النتائج المتوقعة:**
- 📈 **زيادة معدل التحويل** بنسبة 35-50%
- 🔄 **عودة المستخدمين** بنسبة 60%+
- 📱 **تفاعل أكبر** مع الإشعارات
- 🎯 **استهداف أدق** للعملاء
- 📊 **بيانات قيمة** للتحليل والتطوير

### **💡 تحسينات مستقبلية:**
- 🤖 **ذكاء اصطناعي** لتوقع اهتمامات المستخدمين
- 🏆 **برنامج نقاط الولاء** للعملاء المخلصين
- 📦 **تتبع الطلبات** في الوقت الفعلي
- 💬 **دردشة مع العملاء** داخل التطبيق

---

## 🚀 **بدء التشغيل**

```bash
# 1. رفع الملفات المحدثة
git add .
git commit -m "SHIQ v2.0: Advanced User System + Smart Notifications"
git push origin main

# 2. إعداد Google Sheets (4 جداول)
# 3. إعداد Google Apps Script  
# 4. إعداد Firebase للإشعارات
# 5. اختبار النظام

# ✅ النظام جاهز للعمل!
```

---

**🎉 مبروك! لديك الآن نظام متكامل لإدارة المستخدمين والإشعارات الذكية!**

**📞 للدعم والاستفسارات:** اتركوا رسالة في GitHub Issues